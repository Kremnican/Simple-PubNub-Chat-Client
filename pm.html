<!doctype html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Expires" content="Fri, Jan 01 1970 00:00:00 GMT" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta name="MobileOptimized" content="width">
	<meta name="HandheldFriendly" content="true">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">

	<title id="mytitle"></title>
	<script src="http://cdn.pubnub.com/pubnub.min.js"></script>
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script type="text/javascript" src="emoticons/emoticons.js"></script>

	<link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.1/css/bootstrap.min.css">
	<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="emoticons/emoticons.css"/>


	<style id="mystyles"></style>
</head>
<body>
	<div class="header">
		<h1>Chat console</h1>
		<span class="menu-icon" onclick="openNav()">&#9776;</span>
	</div>

	<div id="mySidenav" class="sidenav">
		<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
		<h1>Menu</h1>

		<div class="sidenav-content">
			<div class="row">
				<span>Settings</span>
			</div>
			<div class="row">
				<input type="checkbox" id="want-beep"/><label>Beep</label>
			</div>
			<div class="row">
				<input type="checkbox" id="want-notification" /><label>Notification</label>
			</div>
			<div class="row">
				<input type="checkbox" name="want-smilies" id="want-smilies" checked/><label>Emoticons</label>
			</div>
			<div class="row">
				<input type="checkbox" name="dhl-color" id="dhl-color"/><label>DHL Header colour</label>
			</div>
		</div>
		<div class="sidenav-content">
			<div class="row">
				<span>New connection</span>
			</div>

			<div class="row">
				<input list="newconnection" name="newconnection" id="new-connection" placeholder="Select Room" autocomplete="off">
				<datalist id="connectTo">
					<option value="Room1">
					<option value="Room2">
					<option value="Room3">
					<option value="Room4">
					<option value="Room5">
				</datalist>
			</div>

			<div class="row">
				<input type="checkbox" id="new-window"/><label>Open in new window</label>
			</div>
			<div class="row">
				<button onclick="customChannel()" >Connect</button>
			</div>
		</div>
	</div>

	<div class="main">
		<div class="container">
			<div class="sidebar">
				<div id="userList" class="userList" ></div>
				<button id="leaveButton" class="btn btn-danger leaveButton" onclick="leave()">Leave Chat</button>
			</div>
			<div class="message-box">
				<div id="chatHistory" class="chatHistory"></div>

				<form class="message-input">
					<input type="text" id="message" placeholder="Your message" class="message" autocomplete="off"/>
					<input type="submit" id="sendButton" class="btn btn-primary sendButton" name="Update" value="Go" style="display:none"/>
				</form>

        		<div class="emo-box">
				  	<div class="emo_picker">
						<span class="emoticon emoticon-smile">:)</span>
						<span class="emoticon emoticon-sad-smile">:(</span>
						<span class="emoticon emoticon-big-smile">:D</span>
						<span class="emoticon emoticon-cool">8)</span>
						<span class="emoticon emoticon-wink">;)</span>
						<span class="emoticon emoticon-surprised">:O</span>
						<span class="emoticon emoticon-crying">;(</span>
						<span class="emoticon emoticon-sweating">(sweat)</span>
						<span class="emoticon emoticon-speechless">:|</span>
						<span class="emoticon emoticon-kiss">:*</span>
						<span class="emoticon emoticon-tongue-out">:P</span>
						<span class="emoticon emoticon-blush">:$</span>
						<span class="emoticon emoticon-wondering">:^)</span>
						<span class="emoticon emoticon-sleepy">|-)</span>
						<span class="emoticon emoticon-dull">|("</span>
						<span class="emoticon emoticon-in-love">(inlove)</span>
						<span class="emoticon emoticon-evil-grin">]:)</span>
						<span class="emoticon emoticon-talking">(talk)</span>
						<span class="emoticon emoticon-yawn">(yawn)</span>
						<span class="emoticon emoticon-puke">(puke)</span>
						<span class="emoticon emoticon-doh">(doh)</span>
						<span class="emoticon emoticon-angry">:@</span>
						<span class="emoticon emoticon-it-wasnt-me">(wasntme)</span>
						<span class="emoticon emoticon-party">(party)</span>
						<span class="emoticon emoticon-worried">:S</span>
						<span class="emoticon emoticon-mmm">(mm)</span>
						<span class="emoticon emoticon-nerd">8-|</span>
						<span class="emoticon emoticon-evil-grin-1">]:)</span>
						<span class="emoticon emoticon-lips-sealed">:x</span>
						<span class="emoticon emoticon-hi">(hi)</span>
						<span class="emoticon emoticon-call">(call)</span>
						<span class="emoticon emoticon-devil">(devil)</span>
						<span class="emoticon emoticon-angel">(angel)</span>
						<span class="emoticon emoticon-envy">(envy)</span>
						<span class="emoticon emoticon-wait">(wait)</span>
						<span class="emoticon emoticon-bear">(bear)</span>
						<span class="emoticon emoticon-make-up">(makeup)</span>
						<span class="emoticon emoticon-giggle">(giggle)</span>
						<span class="emoticon emoticon-clapping">(clap)</span>
						<span class="emoticon emoticon-thinking">(think)</span>
						<span class="emoticon emoticon-bow">(bow)</span>
						<span class="emoticon emoticon-rofl">(rofl)</span>
						<span class="emoticon emoticon-whew">(whew)</span>
						<span class="emoticon emoticon-happy">(happy)</span>
						<span class="emoticon emoticon-smirk">(smirk)</span>
						<span class="emoticon emoticon-nod">(nod)</span>
						<span class="emoticon emoticon-shake">(shake)</span>
						<span class="emoticon emoticon-punch">(punch)</span>
						<span class="emoticon emoticon-emo">(emo)</span>
						<span class="emoticon emoticon-yes">(y)</span>
						<span class="emoticon emoticon-no">(n)</span>
						<span class="emoticon emoticon-handshake">(handshake)</span>
						<span class="emoticon emoticon-heart">(h)</span>
						<span class="emoticon emoticon-broken-heart">(u)</span>
						<span class="emoticon emoticon-mail">(e)</span>
						<span class="emoticon emoticon-flower">(f)</span>
						<span class="emoticon emoticon-rain">(rain)</span>
						<span class="emoticon emoticon-sun">(sun)</span>
						<span class="emoticon emoticon-time">(o)</span>
						<span class="emoticon emoticon-music">(music)</span>
						<span class="emoticon emoticon-movie">(~)</span>
						<span class="emoticon emoticon-phone">(mp)</span>
						<span class="emoticon emoticon-coffee">(coffee)</span>
						<span class="emoticon emoticon-pizza">(pi)</span>
						<span class="emoticon emoticon-cash">(cash)</span>
						<span class="emoticon emoticon-muscle">(muscle)</span>
						<span class="emoticon emoticon-cake">(cake)</span>
						<span class="emoticon emoticon-beer">(beer)</span>
						<span class="emoticon emoticon-drink">(d)</span>
						<span class="emoticon emoticon-dance">(dance)</span>
						<span class="emoticon emoticon-ninja">(ninja)</span>
						<span class="emoticon emoticon-star">(*)</span>
						<span class="emoticon emoticon-mooning">(mooning)</span>
						<span class="emoticon emoticon-finger">(finger)</span>
						<span class="emoticon emoticon-bandit">(bandit)</span>
						<span class="emoticon emoticon-drunk">(drunk)</span>
						<span class="emoticon emoticon-smoking">(smoking)</span>
						<span class="emoticon emoticon-toivo">(toivo)</span>
						<span class="emoticon emoticon-rock">(rock)</span>
						<span class="emoticon emoticon-headbang">(headbang)</span>
						<span class="emoticon emoticon-bug">(bug)</span>
						<span class="emoticon emoticon-fubar">(fubar)</span>
						<span class="emoticon emoticon-poolparty">(poolparty)</span>
						<span class="emoticon emoticon-swear">(swear)</span>
						<span class="emoticon emoticon-tmi">(tmi)</span>
						<span class="emoticon emoticon-heidy">(heidy)</span>
						<span class="emoticon emoticon-malthe">(malthe)</span>
						<span class="emoticon emoticon-tauri">(tauri)</span>
						<span class="emoticon emoticon-priidu">(priidu)</span>
				  	</div>
				  	<div id="emo-icon" class="emoticon emoticon-smile">:)</div>
				</div>
        	</div>
		</div>
	</div>

	<div class="footer">
		<span>Simple PubNub chat client. By Sipo 3NN</span>
	</div>

	<script type="text/javascript">



		(function() {

			/*//nahodne pozadie*/
			var images = ['Images/wolf.jpg','Images/clif.jpg','Images/colors.jpg','Images/girl.jpg','Images/jerry.jpg','Images/mountin.jpg','Images/road.jpg','Images/sky.jpg','Images/wolf2.jpg',];
			document.getElementsByClassName('main')[0].style.backgroundImage = 'url(' + images[Math.round(Math.random() * images.length)] + ')';

			//ziskaj username a room pass, odstran medzery a sprav uppercase
			myusername = window.location.search.substring(1).split(',')[0];
			str = myusername.replace(/%20/g, "");
			replaced = str.toLowerCase().replace(/\b[a-z]/g, function(letter) {return letter.toUpperCase();});
			var mychannel = window.location.search.substring(1).split(',')[1];
			/*alert(usernamee);*/

			//Moje kluce
			var publish_key = 'pub-c-7170cfb0-336d-4938-9ba9-5ac184687a93';
			var subscribe_key = 'sub-c-65c8a18e-1a25-11e8-a62b-2601d0c1a2aa';

			channel = mychannel;
			var username = replaced;
			//aktualny cas
			var time = new Date().toLocaleTimeString('en-GB', { hour: "numeric", minute: "numeric"});
			var myclass = "myClass";

			//Aktualizuj title podla kanala
			$('#mytitle')[0].innerHTML = $('#mytitle')[0].innerHTML + 'Chat - ' + mychannel;

			//Aktualizuj styles
			$('#mystyles')[0].innerHTML = '.' + username + ' .user-message{background:#f8bd77;text-align: right;color:#000} .' + username + ' .user-name{float:right} .' + username + ' .user-time{float:left}';

			pubnub = PUBNUB.init({
				publish_key : publish_key,
				subscribe_key : subscribe_key,
				mytime : time,
				uuid : username,
				className : myclass
			});

			pubnub.history({
				channel  : channel,
				count    : 15,

				callback : function(message) {
						content = message.toString().replace( /,/ig, '' );
						mycontent = content.substring(0, content.length - 34);
						$('#chatHistory')[0].innerHTML = mycontent + $('#chatHistory')[0].innerHTML;
						scrollToBottom();
				}
			});

			pubnub.subscribe({
				channel : channel,
				callback : function(message) {
					$('#chatHistory')[0].innerHTML = $('#chatHistory')[0].innerHTML + message;
					scrollToBottom();

					//Ak nie je okno aktivne zrob notifikaciu a beep, vzhladom na checkbox
					if (!document.hasFocus()) {
						var beepit = document.getElementById('want-beep');
						if (beepit.checked) {
							beep();
						}


						/*
						// Users have to enable pop-up windows to make notifications work
						window.onerror = function(){return true;}
						var notifyme = document.getElementById('want-notification');

						if (notifyme.checked) {
							var linkb = 'nm.html?';
							wheight=600;
							wwidth=330;
							tt=window.innerHeight-wheight;
							ll=window.innerWidth-wwidth;
							notification = window.open(linkb,'newMessage','width=250,height=40,top='+ tt +',left=' + ll);
							notification.focus();
						}*/

					}
				},
				presence : function(state) {
					if (state.action == 'join') {
						if ($('#userList').text().indexOf(state.uuid) == -1) {
							$('#userList')[0].innerHTML = state.uuid + '<br/><br/>' + $('#userList')[0].innerHTML;
						}
					} else if (state.action == 'leave' || state.action == 'timeout') {
						var index = $('#userList')[0].innerHTML.indexOf(state.uuid);
						if ( index !== -1) {
							$('#userList')[0].innerHTML = $('#userList')[0].innerHTML.substring(0,index) +
							$('#userList')[0].innerHTML.substring(index+state.uuid.length+8);
						}
					}
				}
			});

			function beep() {
				var snd = new Audio("data:audio/mpeg;base64,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wZ0G7jqlt/OcDIKX+/1NblSX+VKfQfP8xuJJGk7////rf////+PgXTv///1JThJJQainmySAB6imUyuVbVttUo7T4Csa821OuF88f62+CZHFnGf///mQgYIEO0SMF2NVy9NxYTdlqJ8AuS4zr//SJoTUJ+CaKKTcZvosrUPo8W/MUv0f033E9E/QpN6P///v/////WRR2mwUAYUABjabRu1vrOLKAF0kIdHjnEx/iNWo7jGn1////mApxNTJQQOU1Het/NoUFTMQs6Vja///THaGIl/0fojl8mjd/Jo8W+ZfpNpCajsz7////6kn/////WRRgDz//LD1KSTDjKOciSAKxdLx5S31uYqKIWj/+5JECgAC8V5M6g9rdFyr6Vo9rW6KtHcr5DEJQRkSpLRklSigvVc4QpmyPe9H3zHR1/in9P/8VNCMJOzYUDyVjfwHP0ZgiZt/3/+9EBnDKbegdUrckhgntHaQ9vX/X/9A/////+r/////mJ3/9ItRcoVRogAcmV9N8z0pvES8QQsKoMGXEymPQyWm6E4HQLqgpv/CZJAtYXQSwoF8e6SB56zABEoW+qgZjJAZovGr0Gl5/OjFKL3JwnaX9v7/X8y1f/////////49WAzMzEYYMZLq6CUANIqbDX7lisBIdraAEPwShTRc9WZ2vAqBc4NQ9GrUNaw0Czcrte0g1NEoiU8NFjx4NFh54FSwlOlgaCp0S3hqo8SLOh3/63f7P/KgKJxxhgGSnAFMCnIogwU5JoqBIDAuBIiNLETyFmiImtYiDTSlb8ziIFYSFv/QPC38zyxEOuPeVGHQ77r/1u/+kq49//6g4gjoVQSUMYQUSAP8PwRcZIyh2kCI2OwkZICZmaZxgnsNY8DmSCWX0idhtz3VTJSqErTSB//1X7TTTVVV//uSZB2P8xwRJ4HvYcItQlWBACM4AAABpAAAACAAADSAAAAEVf/+qCE000VVVVU0002//+qqqqummmmr///qqqppppoqqqqppppoqqATkEjIyIxBlBA5KwUEDBBwkFhYWFhUVFfiqhYWFhcVFRUVFv/Ff/xUVFRYWFpMQU1FMy45OS41qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==");
				snd.play();
			}

			function bottom() {
				var objDiv = document.getElementById("chatHistory");
				objDiv.scrollTop = objDiv.scrollHeight;
			};

			const scrollToBottom = () => {
				$('#chatHistory').scrollTop($('#chatHistory')[0].scrollHeight);
			};

			pubnub.bind('click', pubnub.$('sendButton'), function(e) {
				var text = $('#message').val()
				if(text == ""){ //Validation
					alert("Please write something in comment.");
				} else {
					var definition = {smile:{title:"Smile",codes:[":)",":=)",":-)"]},"sad-smile":{title:"Sad Smile",codes:[":(",":=(",":-("]},"big-smile":{title:"Big Smile",codes:[":D",":=D",":-D",":d",":=d",":-d"]},cool:{title:"Cool",codes:["8)","8=)","8-)","B)","B=)","B-)","(cool)"]},wink:{title:"Wink",codes:[";)",";-)",";=)"]},surprised:{title:"Surprised",codes:[":O",":o"]},crying:{title:"Crying",codes:[";(",";-(",";=("]},sweating:{title:"Sweating",codes:["(sweat)","(:|"]},speechless:{title:"Speechless",codes:[":|",":=|",":-|"]},kiss:{title:"Kiss",codes:[":*",":=*",":-*"]},"tongue-out":{title:"Tongue Out",codes:[":P",":=P",":-P",":p",":=p",":-p"]},blush:{title:"Blush",codes:["(blush)",":$",":-$",":=$",':">']},wondering:{title:"Wondering",codes:[":^)"]},sleepy:{title:"Sleepy",codes:["|-)","I-)","I=)","(snooze)"]},dull:{title:"Dull",codes:["|(","|-(","|=("]},"in-love":{title:"In love",codes:["(inlove)"]},"evil-grin":{title:"Evil grin",codes:["]:)",">:)","(grin)"]},talking:{title:"Talking",codes:["(talk)"]},yawn:{title:"Yawn",codes:["(yawn)","|-()"]},puke:{title:"Puke",codes:["(puke)",":&",":-&",":=&"]},"doh!":{title:"Doh!",codes:["(doh)"]},angry:{title:"Angry",codes:[":@",":-@",":=@","x(","x-(","x=(","X(","X-(","X=("]},"it-wasnt-me":{title:"It wasn't me",codes:["(wasntme)"]},party:{title:"Party!!!",codes:["(party)"]},worried:{title:"Worried",codes:[":S",":-S",":=S",":s",":-s",":=s"]},mmm:{title:"Mmm...",codes:["(mm)"]},nerd:{title:"Nerd",codes:["8-|","B-|","8|","B|","8=|","B=|","(nerd)"]},"lips-sealed":{title:"Lips Sealed",codes:[":x",":-x",":X",":-X",":#",":-#",":=x",":=X",":=#"]},hi:{title:"Hi",codes:["(hi)"]},call:{title:"Call",codes:["(call)"]},devil:{title:"Devil",codes:["(devil)"]},angel:{title:"Angel",codes:["(angel)"]},envy:{title:"Envy",codes:["(envy)"]},wait:{title:"Wait",codes:["(wait)"]},bear:{title:"Bear",codes:["(bear)","(hug)"]},"make-up":{title:"Make-up",codes:["(makeup)","(kate)"]},"giggle":{title:"Covered Laugh",codes:["(giggle)","(chuckle)"]},"clapping-hands":{title:"Clapping Hands",codes:["(clap)"]},thinking:{title:"Thinking",codes:["(think)",":?",":-?",":=?"]},bow:{title:"Bow",codes:["(bow)"]},rofl:{title:"Rolling on the floor laughing",codes:["(rofl)"]},whew:{title:"Whew",codes:["(whew)"]},happy:{title:"Happy",codes:["(happy)"]},smirking:{title:"Smirking",codes:["(smirk)"]},nodding:{title:"Nodding",codes:["(nod)"]},shaking:{title:"Shaking",codes:["(shake)"]},punch:{title:"Punch",codes:["(punch)"]},emo:{title:"Emo",codes:["(emo)"]},yes:{title:"Yes",codes:["(y)","(Y)","(ok)"]},no:{title:"No",codes:["(n)","(N)"]},handshake:{title:"Shaking Hands",codes:["(handshake)"]},skype:{title:"Skype",codes:["(skype)","(ss)"]},heart:{title:"Heart",codes:["(h)","<3","(H)","(l)","(L)"]},"broken-heart":{title:"Broken heart",codes:["(u)","(U)"]},mail:{title:"Mail",codes:["(e)","(m)"]},flower:{title:"Flower",codes:["(f)","(F)"]},rain:{title:"Rain",codes:["(rain)","(london)","(st)"]},sun:{title:"Sun",codes:["(sun)"]},time:{title:"Time",codes:["(o)","(O)","(time)"]},music:{title:"Music",codes:["(music)"]},movie:{title:"Movie",codes:["(~)","(film)","(movie)"]},phone:{title:"Phone",codes:["(mp)","(ph)"]},coffee:{title:"Coffee",codes:["(coffee)"]},pizza:{title:"Pizza",codes:["(pizza)","(pi)"]},cash:{title:"Cash",codes:["(cash)","(mo)","($)"]},muscle:{title:"Muscle",codes:["(muscle)","(flex)"]},cake:{title:"Cake",codes:["(^)","(cake)"]},beer:{title:"Beer",codes:["(beer)"]},drink:{title:"Drink",codes:["(d)","(D)"]},dance:{title:"Dance",codes:["(dance)","\\o/","\\:D/","\\:d/"]},ninja:{title:"Ninja",codes:["(ninja)"]},star:{title:"Star",codes:["(*)"]},mooning:{title:"Mooning",codes:["(mooning)"]},finger:{title:"Finger",codes:["(finger)"]},bandit:{title:"Bandit",codes:["(bandit)"]},drunk:{title:"Drunk",codes:["(drunk)"]},smoking:{title:"Smoking",codes:["(smoking)","(smoke)","(ci)"]},toivo:{title:"Toivo",codes:["(toivo)"]},rock:{title:"Rock",codes:["(rock)"]},headbang:{title:"Headbang",codes:["(headbang)","(banghead)"]},bug:{title:"Bug",codes:["(bug)"]},fubar:{title:"Fubar",codes:["(fubar)"]},poolparty:{title:"Poolparty",codes:["(poolparty)"]},swearing:{title:"Swearing",codes:["(swear)"]},tmi:{title:"TMI",codes:["(tmi)"]},heidy:{title:"Heidy",codes:["(heidy)"]},myspace:{title:"MySpace",codes:["(MySpace)"]},malthe:{title:"Malthe",codes:["(malthe)"]},tauri:{title:"Tauri",codes:["(tauri)"]},priidu:{title:"Priidu",codes:["(priidu)"]}};
					$.emoticons.define(definition);

					var textWithEmoticons = $.emoticons.replace(text); // Replace your plain text with emoticons.
					var etime = new Date().toLocaleTimeString('en-GB', { hour: "numeric", minute: "numeric"});

					pubnub.publish({
						channel : channel,
						message : '<div class="post ' + pubnub.get_uuid() + ' "><span class="user-name">' + pubnub.get_uuid() + '</span><span class="user-time">' + etime + '</span><div class="user-message">' + textWithEmoticons + '</div></div>'
					});
					$('#message').val('');
				}
			});
		})();

		function customChannel() {
			var username = window.location.search.substring(1).split(',')[0];
			var partner = $('#new-connection').val();
			var newindow = document.getElementById('new-window');
			var connlink = 'pm.html?' + username + ',' + partner;

			if (!newindow.checked) {
				window.location = 'pm.html?' + username + ',' + partner;
			} else {
				var winname = Math.floor(1000 + Math.random() * 9000);
				window.open(connlink, winname,'width=300,height=405');
			}
		}

	</script>
	<script type="text/javascript">
		function leave() {
			pubnub.unsubscribe({
				channel : channel,
				callback : function() {
					window.location = 'login.html';
				}
			});
		}
	</script>
	<script>
		function openNav() {document.getElementById("mySidenav").style.marginLeft = "0";}
		function closeNav() {document.getElementById("mySidenav").style.marginLeft = "-300px";}

		$('input[name=want-smilies]').change(function() {
			var smilies = document.getElementById('want-smilies');
			if (smilies.checked) {
				$('#chatHistory').addClass('smilies-enabled');
				$('#chatHistory').removeClass('smilies-disabled');
			} else if (!smilies.checked) {
				$('#chatHistory').addClass('smilies-disabled');
				$('#chatHistory').removeClass('smilies-enabled');
			}
		});
		$('input[name=dhl-color]').change(function() {
			var dhl = document.getElementById('dhl-color');
			if (dhl.checked) {
				$('body').addClass('dhl');
			} else if (!dhl.checked) {
				$('body').removeClass('dhl');
			}
		});

	</script>
	<script type="text/javascript">
    $(function() {
        $('.emo_picker span').click(function() {
            var value = $(this).text();
            var input = $('#message');
            input.val(input.val() + " " + value + " " );
             $('#message').focus();
            return false;
        });
    });
	</script>

</body>
</html>
